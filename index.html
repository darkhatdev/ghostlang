<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂêçÊ°• MindBridge</title>
    <meta name="description" content="Learn Chinese through pattern recognition">
    <meta name="theme-color" content="#0f0a1e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300;400;500;700;900&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
        body{font-family:'Outfit',sans-serif;overflow:hidden;height:100vh;height:100dvh}
        #root{height:100%}
        ::-webkit-scrollbar{width:4px}
        ::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.12);border-radius:2px}
        @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(232,100,100,0.5)}50%{box-shadow:0 0 0 12px rgba(232,100,100,0)}}
        @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        @keyframes breathe{0%,100%{opacity:0.6}50%{opacity:1}}
    </style>
    <script>
      // Register service worker for PWA + offline
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').then(r => console.log('SW registered')).catch(e => console.log('SW failed', e));
      }
    </script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ÂêçÊ°• MINDBRIDGE v7 ‚Äî PWA Edition
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const THEMES = {
  cosmic:{name:"Cosmic",emoji:"üåå",bg:"linear-gradient(170deg,#0f0a1e 0%,#1a1035 40%,#1e0f2e 70%,#120a20 100%)",bgSolid:"#0f0a1e",surface:"rgba(255,255,255,0.04)",card:"rgba(255,255,255,0.06)",cardHover:"rgba(255,255,255,0.10)",header:"rgba(15,10,30,0.92)",accent:"#c4a0e8",accent2:"#e8b87a",glow:"rgba(196,160,232,0.15)",t1:"#e8dff5",t2:"#a899c0",t3:"#7a6b94",border:"rgba(255,255,255,0.08)",font:"'Ma Shan Zheng','Noto Sans SC',cursive"},
  tarot:{name:"Tarot",emoji:"üîÆ",bg:"linear-gradient(170deg,#141025 0%,#1f1540 40%,#251845 70%,#0f0a1e 100%)",bgSolid:"#141025",surface:"rgba(255,255,255,0.04)",card:"rgba(255,255,255,0.06)",cardHover:"rgba(255,255,255,0.10)",header:"rgba(20,16,37,0.92)",accent:"#d4a574",accent2:"#c490d6",glow:"rgba(212,165,116,0.15)",t1:"#f0e6d8",t2:"#c0a888",t3:"#8a7a68",border:"rgba(255,255,255,0.08)",font:"'Ma Shan Zheng','Noto Sans SC',cursive"},
  nebula:{name:"Nebula",emoji:"üí´",bg:"linear-gradient(170deg,#0a0f1e 0%,#0f1a35 40%,#1a1040 70%,#0a0818 100%)",bgSolid:"#0a0f1e",surface:"rgba(255,255,255,0.04)",card:"rgba(255,255,255,0.06)",cardHover:"rgba(255,255,255,0.10)",header:"rgba(10,15,30,0.92)",accent:"#e8a0b8",accent2:"#80b8e8",glow:"rgba(232,160,184,0.15)",t1:"#f0e0ea",t2:"#b898a8",t3:"#886878",border:"rgba(255,255,255,0.08)",font:"'Noto Sans SC',sans-serif"},
  zen:{name:"Zen",emoji:"‚óªÔ∏è",bg:"linear-gradient(170deg,#f8f6f2 0%,#f0ece4 100%)",bgSolid:"#f8f6f2",surface:"rgba(0,0,0,0.02)",card:"rgba(0,0,0,0.03)",cardHover:"rgba(0,0,0,0.06)",header:"rgba(248,246,242,0.95)",accent:"#8a7a6a",accent2:"#a08878",glow:"rgba(138,122,106,0.08)",t1:"#2a2520",t2:"#6a6055",t3:"#9a9088",border:"rgba(0,0,0,0.08)",font:"'Noto Sans SC',sans-serif"},
};

const R={
  subject:{c:"#FF8A8A",s:"S"},verb:{c:"#6EEAE0",s:"V"},object:{c:"#FFE88A",s:"O"},
  particle:{c:"#BEA4F4",s:"P"},adjective:{c:"#FFB06A",s:"Adj"},adverb:{c:"#50D4E8",s:"Adv"},
  measure:{c:"#A88CF6",s:"MW"},time:{c:"#F4BE50",s:"T"},location:{c:"#50D4A0",s:"Loc"},
  question:{c:"#FF7088",s:"Q"},pronoun:{c:"#E8A0F4",s:"Pn"},negation:{c:"#FF6A6A",s:"Neg"},
};

const TC={1:"#6aaaf0",2:"#5cc47a",3:"#e8a44a",4:"#e05858",5:"#8888aa"};
function gt(p){if(/[ƒÅƒìƒ´≈ç≈´«ñ]/.test(p))return 1;if(/[√°√©√≠√≥√∫«ò]/.test(p))return 2;if(/[«éƒõ«ê«í«î«ö]/.test(p))return 3;if(/[√†√®√¨√≤√π«ú]/.test(p))return 4;return 5;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STORIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const STORIES=[
  {id:"st1",cat:"üó£Ô∏è Slang",title:"ÁâõÈÄº ni√∫bƒ´ ‚Äî The Ultimate Compliment",titleP:"ÁâõÈÄº ni√∫bƒ´ ‚Äî O Elogio Supremo",body:"When something blows your mind, you say ÁâõÈÄº (ni√∫bƒ´). Literally 'cow pussy' ‚Äî yes, really. It means 'awesome/badass'. Friend aced the exam? Â§™ÁâõÈÄº‰∫ÜÔºÅThe polite version is Áâõ (ni√∫) alone. In texting: NB.",bodyP:"Quando algo te impressiona, voc√™ diz ÁâõÈÄº. Literalmente... 'vagina de vaca'. Significa 'incr√≠vel/foda'. A vers√£o educada √© Áâõ sozinho. Em mensagens: NB.",key:"ÁâõÈÄº = awesome/badass. Short: Áâõ. Text: NB.",keyP:"ÁâõÈÄº = incr√≠vel/foda. Curto: Áâõ. Texto: NB."},
  {id:"st2",cat:"üó£Ô∏è Slang",title:"666 li√πli√πli√π ‚Äî Smooth Operator",titleP:"666 li√πli√πli√π ‚Äî Mandou Bem",body:"In gaming and social media, 666 means 'skilled/smooth'. Because Ê∫ú (li√π, slick) sounds like ÂÖ≠ (li√π, six). Someone does an amazing play? Chat floods with 666666. Crossed into daily life ‚Äî perfect parking? ÂÖ≠ÂÖ≠ÂÖ≠ÔºÅ",bodyP:"Em jogos, 666 significa 'habilidoso'. Porque Ê∫ú (li√π, h√°bil) soa como ÂÖ≠ (li√π, seis). Jogada incr√≠vel? Chat enche de 666666.",key:"666 = skilled/impressive (from Ê∫ú li√π = smooth)",keyP:"666 = habilidoso (de Ê∫ú li√π = h√°bil)"},
  {id:"st3",cat:"üó£Ô∏è Slang",title:"ÊàëÂéª w«í q√π ‚Äî Chinese 'WTF'",titleP:"ÊàëÂéª w«í q√π ‚Äî O 'WTF' Chin√™s",body:"ÊàëÂéª literally means 'I go' but as an exclamation it's 'WTF/holy crap'. Stub your toe? ÊàëÂéªÔºÅInsane price? ÊàëÂéªÔºÅIt's the clean version of ÊàëÈù† (w«í k√†o). Safe everywhere. Often stretched: ÊàëÂéªÔΩûÔΩûÔΩû",bodyP:"ÊàëÂéª literalmente 'eu vou' mas como exclama√ß√£o √© 'caramba/WTF'. √â a vers√£o limpa de ÊàëÈù†. Seguro em qualquer lugar.",key:"ÊàëÂéª = WTF/holy crap (clean version)",keyP:"ÊàëÂéª = caramba/WTF (vers√£o limpa)"},
  {id:"st4",cat:"üìñ Culture",title:"ÂêÉ‰∫ÜÂêóÔºü‚Äî Have You Eaten?",titleP:"ÂêÉ‰∫ÜÂêóÔºü‚Äî J√° Comeu?",body:"The most Chinese greeting: ‰Ω†ÂêÉ‰∫ÜÂêóÔºü(Have you eaten?) This isn't a lunch invite ‚Äî it's 'hello'. After centuries of famine, asking about food = caring. The answer is always ÂêÉ‰∫Ü even if you're starving. Like 'How are you?' ‚Äî nobody wants the real answer.",bodyP:"O cumprimento mais chin√™s: ‰Ω†ÂêÉ‰∫ÜÂêóÔºüN√£o √© convite ‚Äî √© 'ol√°'. Ap√≥s s√©culos de fome, perguntar sobre comida = se importar. A resposta √© sempre ÂêÉ‰∫Ü mesmo morrendo de fome.",key:"‰Ω†ÂêÉ‰∫ÜÂêó = Hello (literally 'have you eaten?')",keyP:"‰Ω†ÂêÉ‰∫ÜÂêó = Ol√° (literalmente 'j√° comeu?')"},
  {id:"st5",cat:"üìñ Culture",title:"Èù¢Â≠ê mi√†nzi ‚Äî The Face Game",titleP:"Èù¢Â≠ê mi√†nzi ‚Äî O Jogo da Face",body:"Èù¢Â≠ê = face/reputation/social currency. ÁªôÈù¢Â≠ê = give face = show respect publicly. ‰∏¢Èù¢Â≠ê = lose face = public embarrassment. Never correct your Chinese boss in a meeting. Pay the bill at dinner? You're giving face. Even refusing compliments (Âì™ÈáåÂì™Èáå) is face management.",bodyP:"Èù¢Â≠ê = cara/reputa√ß√£o. ÁªôÈù¢Â≠ê = dar face = respeitar publicamente. ‰∏¢Èù¢Â≠ê = perder face = constrangimento. Nunca corrija seu chefe chin√™s em reuni√£o. Pagar o jantar = dar face.",key:"Èù¢Â≠ê = face/reputation. ÁªôÈù¢Â≠ê = respect. ‰∏¢Èù¢Â≠ê = embarrass.",keyP:"Èù¢Â≠ê = reputa√ß√£o. ÁªôÈù¢Â≠ê = respeitar. ‰∏¢Èù¢Â≠ê = constranger."},
  {id:"st6",cat:"üó£Ô∏è Slang",title:"Âä†Ê≤π jiƒÅy√≥u ‚Äî Add Oil!",titleP:"Âä†Ê≤π jiƒÅy√≥u ‚Äî Adiciona √ìleo!",body:"Âä†Ê≤π literally 'add oil/fuel' ‚Äî THE encouragement phrase. Exam? Âä†Ê≤πÔºÅSports? Âä†Ê≤πÂä†Ê≤πÔºÅAdded to the Oxford English Dictionary in 2018. It's 'you got this' + 'keep going' + 'let's go' all in one.",bodyP:"Âä†Ê≤π literalmente 'adicionar √≥leo' ‚Äî A frase de encorajamento. Foi adicionado ao Oxford em 2018. √â 'voc√™ consegue' + 'vai l√°' + 'for√ßa' tudo junto.",key:"Âä†Ê≤π = You got this!/Go for it!",keyP:"Âä†Ê≤π = Vai l√°!/For√ßa!"},
  {id:"st7",cat:"üìñ Culture",title:"Á∫¢ÂåÖ h√≥ngbƒÅo ‚Äî Red Envelopes",titleP:"Á∫¢ÂåÖ h√≥ngbƒÅo ‚Äî Envelopes Vermelhos",body:"Á∫¢ÂåÖ = red envelope with money. Rules: ALWAYS even amounts (odd = funerals). NEVER ¬•4 (Âõõ sounds like Ê≠ª death). Good: 8 (prosperity), 6 (smooth), 9 (long-lasting). WeChat digital Á∫¢ÂåÖ is huge. ¬•5.20 = ÊàëÁà±‰Ω† (I love you) because 520 sounds like it.",bodyP:"Á∫¢ÂåÖ = envelope vermelho com dinheiro. SEMPRE pares (√≠mpares = funerais). NUNCA ¬•4 (Âõõ soa como Ê≠ª morte). WeChat Á∫¢ÂåÖ digital √© enorme. ¬•5.20 = ÊàëÁà±‰Ω† porque 520 soa parecido.",key:"Á∫¢ÂåÖ = red envelope. No 4s! 8=lucky, 520=I love you.",keyP:"Á∫¢ÂåÖ = envelope vermelho. Sem 4! 8=sorte, 520=eu te amo."},
  {id:"st8",cat:"üó£Ô∏è Slang",title:"ÊâìÂç° d«ék«é ‚Äî Check In Culture",titleP:"ÊâìÂç° d«ék«é ‚Äî Cultura do Check-in",body:"ÊâìÂç° meant 'punch a time card'. Now it's checking into trendy spots for social media. Visit a caf√©? ÊâìÂç°ÔºÅGreat Wall photo? ÊâìÂç°ÔºÅÁΩëÁ∫¢ÊâìÂç°Âú∞ = influencer check-in spots. Some places exist only for photos ‚Äî beautiful but food is trash.",bodyP:"ÊâìÂç° significava 'bater ponto'. Agora √© fazer check-in em lugares trendy. Caf√© famoso? ÊâìÂç°ÔºÅÁΩëÁ∫¢ÊâìÂç°Âú∞ = pontos de influencers.",key:"ÊâìÂç° = check in (social media). ÁΩëÁ∫¢ = influencer.",keyP:"ÊâìÂç° = check-in. ÁΩëÁ∫¢ = influencer."},
  {id:"st9",cat:"üìñ Culture",title:"Â∑Æ‰∏çÂ§ö ch√†budu≈ç ‚Äî Close Enough",titleP:"Â∑Æ‰∏çÂ§ö ch√†budu≈ç ‚Äî Quase L√°",body:"Â∑Æ‰∏çÂ§ö = almost/close enough. THE most Chinese concept. Author Lin Yutang wrote about 'Mr. Â∑Æ‰∏çÂ§ö' who thinks everything is 'close enough'. 30 minutes late? Â∑Æ‰∏çÂ§öÊòØÂáÜÊó∂! Chinese culture values flexibility over rigid precision. Like Brazilian 'mais ou menos' on steroids.",bodyP:"Â∑Æ‰∏çÂ§ö = quase/mais ou menos. O conceito MAIS chin√™s. Lin Yutang escreveu sobre o 'Sr. Â∑Æ‰∏çÂ§ö'. 30 minutos atrasado? Â∑Æ‰∏çÂ§öÊòØÂáÜÊó∂! Como 'mais ou menos' turbinado.",key:"Â∑Æ‰∏çÂ§ö = close enough. THE Chinese concept.",keyP:"Â∑Æ‰∏çÂ§ö = quase/mais ou menos. O conceito chin√™s."},
  {id:"st10",cat:"üó£Ô∏è Slang",title:"Ë∫∫Âπ≥ t«éng p√≠ng ‚Äî Lie Flat",titleP:"Ë∫∫Âπ≥ t«éng p√≠ng ‚Äî Deitar e Desistir",body:"Ë∫∫Âπ≥ = lie flat ‚Äî Chinese 'quiet quitting' but radical. Young people overwhelmed by 996 culture (9am-9pm, 6 days) said 'I'll just lie flat'. The government tried to censor it. ÊëÜÁÉÇ (b«éi l√†n) = 'let it rot' ‚Äî even more extreme.",bodyP:"Ë∫∫Âπ≥ = deitar ‚Äî 'desist√™ncia silenciosa' chinesa. Jovens sobrecarregados pela cultura 996 disseram 'vou s√≥ deitar'. O governo tentou censurar. ÊëÜÁÉÇ = 'deixar apodrecer' ‚Äî mais extremo.",key:"Ë∫∫Âπ≥ = lie flat/quit hustling. ÊëÜÁÉÇ = let it rot.",keyP:"Ë∫∫Âπ≥ = deitar/desistir. ÊëÜÁÉÇ = deixar apodrecer."},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LESSONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LESSONS=[
  {id:1,title:"Greetings",tz:"ÈóÆÂÄô",ss:[
    {w:[{h:"‰Ω†",p:"n«ê",e:"you",pt:"voc√™",r:"subject"},{h:"Â•Ω",p:"h«éo",e:"good",pt:"bom/boa",r:"adjective"}],col:"Âó® (hƒÅi) ‚Äî from English 'hi'",colP:"Âó® (hƒÅi) ‚Äî do ingl√™s 'hi'",n:"Literally 'You good'. No verb needed!",nP:"Literalmente 'Voc√™ bom/boa'. Sem verbo!",st:"‰Ω†Â•Ω is formal! Friends say Âó® or ‰Ω†ÂêÉ‰∫ÜÂêóÔºü",stP:"‰Ω†Â•Ω √© formal! Amigos dizem Âó® ou ‰Ω†ÂêÉ‰∫ÜÂêóÔºü"},
    {w:[{h:"Êàë",p:"w«í",e:"I",pt:"eu",r:"subject"},{h:"Âè´",p:"ji√†o",e:"am called",pt:"me chamo",r:"verb"},{h:"È©¨ÂÖã",p:"M«ék√®",e:"Maximus",pt:"Maximus",r:"object"}],col:"ÊàëÊòØÈ©¨ÂÖã ‚Äî more direct",colP:"ÊàëÊòØÈ©¨ÂÖã ‚Äî mais direto",n:"ÊàëÂè´ = 'I am called'. Also ÊàëÊòØ = 'I am'.",nP:"ÊàëÂè´ = 'Me chamo'. Tamb√©m ÊàëÊòØ = 'Eu sou'.",st:"Drop Êàë in texts ‚Äî like Portuguese dropping 'eu'!",stP:"Omita Êàë em mensagens ‚Äî como portugu√™s omitindo 'eu'!"},
    {w:[{h:"‰Ω†",p:"n«ê",e:"you",pt:"voc√™",r:"subject"},{h:"Âè´",p:"ji√†o",e:"called",pt:"chama",r:"verb"},{h:"‰ªÄ‰πà",p:"sh√©nme",e:"what",pt:"o qu√™",r:"question"},{h:"ÂêçÂ≠ó",p:"m√≠ngzi",e:"name",pt:"nome",r:"object"}],col:"‰Ω†Âè´Âï•Ôºü‚Äî Âï• replaces ‰ªÄ‰πà",colP:"‰Ω†Âè´Âï•Ôºü‚Äî Âï• substitui ‰ªÄ‰πà",n:"‰ªÄ‰πà goes WHERE the answer goes! ‰Ω†Âè´[‰ªÄ‰πà]‚ÜíÊàëÂè´[È©¨ÂÖã].",nP:"‰ªÄ‰πà fica ONDE a resposta vai!",st:"Questions keep same structure ‚Äî just swap the question word!",stP:"Perguntas mant√™m mesma estrutura!"},
    {w:[{h:"Âæà",p:"hƒõn",e:"very",pt:"muito",r:"adverb"},{h:"È´òÂÖ¥",p:"gƒÅox√¨ng",e:"happy",pt:"feliz",r:"adjective"},{h:"ËÆ§ËØÜ",p:"r√®nshi",e:"to meet",pt:"conhecer",r:"verb"},{h:"‰Ω†",p:"n«ê",e:"you",pt:"voc√™",r:"object"}],col:"Âπ∏‰ºöÂπ∏‰ºö ‚Äî literary",colP:"Âπ∏‰ºöÂπ∏‰ºö ‚Äî liter√°rio",n:"Âæà before adjectives is grammar, not emphasis!",nP:"Âæà antes de adjetivos √© gram√°tica, n√£o √™nfase!",st:"Âæà fills a structural slot like Portuguese 'o' in 'o c√£o'.",stP:"Âæà preenche lugar como artigos: 'o c√£o' e n√£o s√≥ 'c√£o'."},
  ]},
  {id:2,title:"Daily Life",tz:"Êó•Â∏∏",ss:[
    {w:[{h:"Êàë",p:"w«í",e:"I",pt:"eu",r:"subject"},{h:"‰ªäÂ§©",p:"jƒ´ntiƒÅn",e:"today",pt:"hoje",r:"time"},{h:"Âæà",p:"hƒõn",e:"very",pt:"muito",r:"adverb"},{h:"Âøô",p:"m√°ng",e:"busy",pt:"ocupado",r:"adjective"}],col:"‰ªäÂÑøÂøôÊ≠ª‰∫Ü ‚Äî 'crazy busy'",colP:"‰ªäÂÑøÂøôÊ≠ª‰∫Ü ‚Äî 'super ocupado'",n:"Time ALWAYS before verb: S+TIME+description.",nP:"Tempo SEMPRE antes: S+TEMPO+descri√ß√£o.",st:"Portuguese 'hoje' floats. Chinese locks: Êàë[‰ªäÂ§©]ÂæàÂøô.",stP:"Portugu√™s 'hoje' flutua. Chin√™s fixa: Êàë[‰ªäÂ§©]ÂæàÂøô."},
    {w:[{h:"Êàë",p:"w«í",e:"I",pt:"eu",r:"subject"},{h:"‰∏ç",p:"b√π",e:"not",pt:"n√£o",r:"negation"},{h:"Âñù",p:"hƒì",e:"drink",pt:"beber",r:"verb"},{h:"ÂíñÂï°",p:"kƒÅfƒìi",e:"coffee",pt:"caf√©",r:"object"}],col:"ÂíñÂï°Êàë‰∏çÁ¢∞ ‚Äî topic-fronting!",colP:"ÂíñÂï°Êàë‰∏çÁ¢∞ ‚Äî t√≥pico √† frente!",n:"‰∏ç before verb = negation. ÂíñÂï°‚âàcaf√© ‚Äî same origin!",nP:"‰∏ç antes do verbo = nega√ß√£o. ÂíñÂï°‚âàcaf√©!",st:"Like Portuguese 'O caf√©, eu n√£o bebo'!",stP:"Como 'O caf√©, eu n√£o bebo'!"},
    {w:[{h:"Êàë‰ª¨",p:"w«ímen",e:"we",pt:"n√≥s",r:"subject"},{h:"ÊòéÂ§©",p:"m√≠ngtiƒÅn",e:"tomorrow",pt:"amanh√£",r:"time"},{h:"Âéª",p:"q√π",e:"go",pt:"ir",r:"verb"},{h:"Áúã",p:"k√†n",e:"see",pt:"ver",r:"verb"},{h:"ÁîµÂΩ±",p:"di√†ny«êng",e:"movie",pt:"filme",r:"object"}],col:"ÊòéÂÑøÁúãÁîµÂΩ±Âéª",colP:"ÊòéÂÑøÁúãÁîµÂΩ±Âéª ‚Äî casual",n:"ÂéªÁúã=go+see. No tenses ‚Äî ÊòéÂ§© handles time!",nP:"ÂéªÁúã=ir+ver. Sem tempos!",st:"Same Âéª for all tenses. No conjugation!",stP:"Mesmo Âéª para todos os tempos!"},
  ]},
  {id:3,title:"Shopping",tz:"Ë¥≠Áâ©",ss:[
    {w:[{h:"Ëøô",p:"zh√®",e:"this",pt:"este/a",r:"pronoun"},{h:"‰∏™",p:"g√®",e:"[MW]",pt:"[class.]",r:"measure"},{h:"Â§öÂ∞ë",p:"du≈çshao",e:"how much",pt:"quanto",r:"question"},{h:"Èí±",p:"qi√°n",e:"money",pt:"dinheiro",r:"object"}],col:"ËøôÂíãÂçñÁöÑÔºü",colP:"ËøôÂíãÂçñÁöÑÔºü",n:"‰∏™=universal measure word.",nP:"‰∏™=classificador universal.",st:"Like Portuguese 'um copo DE √°gua'!",stP:"Como 'um copo DE √°gua'!"},
    {w:[{h:"Â§™",p:"t√†i",e:"too",pt:"demais",r:"adverb"},{h:"Ë¥µ",p:"gu√¨",e:"expensive",pt:"caro",r:"adjective"},{h:"‰∫Ü",p:"le",e:"[change!]",pt:"[mudan√ßa!]",r:"particle"}],col:"Â•ΩË¥µÂïä ‚Äî emotional!",colP:"Â•ΩË¥µÂïä ‚Äî emocional!",n:"‰∫Ü=CHANGE marker, NOT past tense!",nP:"‰∫Ü=MUDAN√áA, N√ÉO passado!",st:"Like Portuguese 'ficou caro' ‚Äî ‰∫Ü does that!",stP:"Como 'ficou caro' ‚Äî ‰∫Ü faz isso!"},
    {w:[{h:"ÂèØ‰ª•",p:"kƒõy«ê",e:"can",pt:"pode",r:"verb"},{h:"‰æøÂÆú",p:"pi√°nyi",e:"cheaper",pt:"mais barato",r:"adjective"},{h:"‰∏ÄÁÇπ",p:"y√¨di«én",e:"a little",pt:"um pouco",r:"adverb"},{h:"Âêó",p:"ma",e:"[yes/no?]",pt:"[sim/n√£o?]",r:"particle"}],col:"ËÉΩ‰∏çËÉΩ‰æøÂÆúÁÇπÂÑøÔºü",colP:"ËÉΩ‰∏çËÉΩ‰æøÂÆúÁÇπÂÑøÔºü",n:"Âêó=yes/no. ËÉΩ‰∏çËÉΩ=can-not-can?",nP:"Âêó=sim/n√£o. ËÉΩ‰∏çËÉΩ=pode-n√£o-pode?",st:"V‰∏çV for bargaining!",stP:"V‰∏çV para pechinchar!"},
  ]},
  {id:4,title:"Food",tz:"ÂêÉÈ•≠",ss:[
    {w:[{h:"Êàë",p:"w«í",e:"I",pt:"eu",r:"subject"},{h:"ÊÉ≥",p:"xi«éng",e:"want",pt:"quero",r:"verb"},{h:"ÂêÉ",p:"chƒ´",e:"eat",pt:"comer",r:"verb"},{h:"ÁÅ´ÈîÖ",p:"hu«ígu≈ç",e:"hotpot",pt:"hotpot",r:"object"}],col:"Êï¥ÁÇπÁÅ´ÈîÖ ‚Äî 'let's get hotpot'",colP:"Êï¥ÁÇπÁÅ´ÈîÖ ‚Äî 'bora hotpot'",n:"ÊÉ≥+verb = want to. Stack verbs!",nP:"ÊÉ≥+verbo = querer. Empilhe!",st:"ÁÅ´ÈîÖ = 'fire pot'. Everyone shares one pot!",stP:"ÁÅ´ÈîÖ = 'panela de fogo'. Todos dividem!"},
    {w:[{h:"Ëøô",p:"zh√®",e:"this",pt:"isto",r:"pronoun"},{h:"‰∏™",p:"g√®",e:"[MW]",pt:"[class.]",r:"measure"},{h:"Ëèú",p:"c√†i",e:"dish",pt:"prato",r:"object"},{h:"Â§™",p:"t√†i",e:"too",pt:"demais",r:"adverb"},{h:"Ëæ£",p:"l√†",e:"spicy",pt:"picante",r:"adjective"},{h:"‰∫Ü",p:"le",e:"[!]",pt:"[!]",r:"particle"}],col:"Ëæ£Ê≠ªÊàë‰∫ÜÔºÅ‚Äî spicy killed me!",colP:"Ëæ£Ê≠ªÊàë‰∫ÜÔºÅ‚Äî picante me matou!",n:"Â§™...‰∫Ü = too/excessively pattern.",nP:"Â§™...‰∫Ü = demais.",st:"Ê≠ª‰∫Ü after adj = 'to death' ‚Äî extreme emphasis!",stP:"Ê≠ª‰∫Ü = 'de morrer' ‚Äî √™nfase extrema!"},
    {w:[{h:"ÊúçÂä°Âëò",p:"f√∫w√πyu√°n",e:"waiter",pt:"gar√ßom",r:"object"},{h:"‰π∞Âçï",p:"m«éidƒÅn",e:"bill please",pt:"a conta",r:"verb"}],col:"ÁªìË¥¶ ji√©zh√†ng ‚Äî northern style",colP:"ÁªìË¥¶ ‚Äî mais do norte",n:"ÊúçÂä°Âëò! Not rude in China ‚Äî it's normal!",nP:"ÊúçÂä°Âëò! N√£o √© rude na China!",st:"Fighting to pay (Êä¢‰π∞Âçï) is a cultural ritual!",stP:"Brigar para pagar (Êä¢‰π∞Âçï) √© ritual cultural!"},
  ]},
  {id:5,title:"Transport",tz:"‰∫§ÈÄö",ss:[
    {w:[{h:"Êàë",p:"w«í",e:"I",pt:"eu",r:"subject"},{h:"Ë¶Å",p:"y√†o",e:"want to",pt:"quero",r:"verb"},{h:"Âéª",p:"q√π",e:"go to",pt:"ir para",r:"verb"},{h:"Êú∫Âú∫",p:"jƒ´ch«éng",e:"airport",pt:"aeroporto",r:"location"}],col:"Ëµ∞ÔºåÂéªÊú∫Âú∫ ‚Äî 'let's go'",colP:"Ëµ∞ÔºåÂéªÊú∫Âú∫ ‚Äî 'bora'",n:"Ë¶Å+verb = will/want to. Stronger than ÊÉ≥.",nP:"Ë¶Å+verbo = vai/quer. Mais forte que ÊÉ≥.",st:"Ëµ∞ alone = 'let's go!' ‚Äî action word!",stP:"Ëµ∞ sozinho = 'vamos!'"},
    {w:[{h:"Âú∞ÈìÅ",p:"d√¨tiƒõ",e:"subway",pt:"metr√¥",r:"object"},{h:"Á´ô",p:"zh√†n",e:"station",pt:"esta√ß√£o",r:"object"},{h:"Âú®",p:"z√†i",e:"is at",pt:"fica em",r:"verb"},{h:"Âì™Èáå",p:"n«él«ê",e:"where",pt:"onde",r:"question"}],col:"Âú∞ÈìÅÂú®Âì™ÂÑøÔºü‚Äî Beijing ÂÑø",colP:"Âú∞ÈìÅÂú®Âì™ÂÑøÔºü‚Äî ÂÑø = Pequim",n:"Âú®+Âì™Èáå = is where? Same swap as ‰ªÄ‰πà!",nP:"Âú®+Âì™Èáå = onde fica?",st:"ÂÑøÂåñÈü≥ ‚Äî Beijing's 'r' suffix. Linguistic fingerprint!",stP:"ÂÑøÂåñÈü≥ ‚Äî sufixo 'r' de Pequim!"},
    {w:[{h:"Â∏àÂÇÖ",p:"shƒ´fu",e:"driver",pt:"motorista",r:"subject"},{h:"ËØ∑",p:"q«êng",e:"please",pt:"por favor",r:"adverb"},{h:"ÂºÄ",p:"kƒÅi",e:"drive",pt:"dirigir",r:"verb"},{h:"ÊÖ¢",p:"m√†n",e:"slow",pt:"devagar",r:"adverb"},{h:"‰∏ÄÁÇπ",p:"y√¨di«én",e:"a bit",pt:"um pouco",r:"adverb"}],col:"ÊÖ¢ÁÇπÂÑøÂºÄÔºÅ‚Äî direct",colP:"ÊÖ¢ÁÇπÂÑøÂºÄÔºÅ‚Äî direto",n:"Â∏àÂÇÖ = respectful for any skilled worker!",nP:"Â∏àÂÇÖ = respeitoso para trabalhadores h√°beis!",st:"ËØ∑ is magic but politeness is more about Èù¢Â≠ê.",stP:"ËØ∑ √© m√°gico mas polidez √© mais sobre Èù¢Â≠ê."},
  ]},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMPONENTS (same as v6, compacted)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function WordCard({word,lang,pinyin,active,onClick,th,fs}){
  const role=R[word.r]||R.object,tone=gt(word.p),tc=TC[tone];
  const tr=lang==="portuguese"?word.pt:lang==="english"?word.e:`${word.e} ¬∑ ${word.pt}`;
  return React.createElement('div',{onClick,style:{display:'flex',flexDirection:'column',alignItems:'center',gap:'4px',cursor:'pointer',transition:'transform 0.2s',transform:active?'scale(1.06)':'scale(1)',animation:'fadeIn 0.3s ease'}},
    React.createElement('div',{style:{background:th.surface,backdropFilter:'blur(12px)',border:`1px solid ${th.border}`,borderRadius:'10px',padding:'4px 10px',fontSize:`${fs*0.28}px`,color:th.t2,fontWeight:500,textAlign:'center',maxWidth:`${fs*5}px`,lineHeight:1.3,position:'relative',marginBottom:'2px'}},tr,
      React.createElement('div',{style:{position:'absolute',bottom:'-6px',left:'50%',transform:'translateX(-50%)',width:0,height:0,borderLeft:'6px solid transparent',borderRight:'6px solid transparent',borderTop:`6px solid ${th.border}`}})
    ),
    React.createElement('div',{style:{position:'relative',width:`${fs*2.6}px`,height:`${fs*2.6}px`,background:active?th.cardHover:th.card,backdropFilter:'blur(12px)',border:`2px solid ${active?role.c+'60':th.border}`,borderRadius:`${fs*0.35}px`,display:'flex',alignItems:'center',justifyContent:'center',boxShadow:active?`0 4px 24px ${th.glow}`:'0 2px 8px rgba(0,0,0,0.1)',transition:'all 0.25s ease',overflow:'hidden'}},
      React.createElement('div',{style:{position:'absolute',left:0,top:0,bottom:0,width:`${fs*0.12}px`,background:role.c,opacity:0.6,borderRadius:`${fs*0.35}px 0 0 ${fs*0.35}px`}}),
      React.createElement('span',{style:{fontSize:`${fs*1.1}px`,fontWeight:700,color:th.t1,fontFamily:th.font}},word.h)
    ),
    pinyin&&React.createElement('div',{style:{display:'flex',alignItems:'center',gap:'4px',fontSize:`${fs*0.32}px`,color:tc,fontWeight:600,fontFamily:"'JetBrains Mono',monospace"}},word.p,React.createElement('span',{style:{width:'6px',height:'6px',borderRadius:'3px',background:tc}})),
    React.createElement('div',{style:{fontSize:`${fs*0.2}px`,color:role.c,fontWeight:700,textTransform:'uppercase',letterSpacing:'1px',padding:'1px 6px',borderRadius:'4px',background:`${role.c}15`}},role.s)
  );
}

function SentenceView({s,lang,pin,ai,setAi,spk,th,fs,showC,showS}){
  const full=s.w.map(w=>w.h).join(""),fullP=s.w.map(w=>w.p).join(" "),isP=lang==="portuguese"||lang==="both";
  return React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:`${fs*0.35}px`}},
    React.createElement('div',{style:{background:th.surface,backdropFilter:'blur(12px)',borderRadius:`${fs*0.4}px`,padding:`${fs*0.4}px`,border:`1px solid ${th.border}`}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:'8px',marginBottom:`${fs*0.3}px`}},
        React.createElement('div',null,
          React.createElement('div',{style:{fontSize:`${fs*0.65}px`,color:th.t1,fontFamily:th.font,fontWeight:700,letterSpacing:'2px'}},full),
          pin&&React.createElement('div',{style:{fontSize:`${fs*0.3}px`,color:th.t3,fontFamily:"'JetBrains Mono',monospace",marginTop:'2px'}},fullP)
        ),
        React.createElement('button',{onClick:()=>spk(full),style:{background:`${th.accent}18`,border:`1px solid ${th.accent}30`,borderRadius:'10px',padding:`${fs*0.14}px ${fs*0.35}px`,color:th.accent,cursor:'pointer',fontSize:`${fs*0.34}px`,fontWeight:600}},"üîä")
      ),
      React.createElement('div',{style:{display:'flex',flexWrap:'wrap',gap:`${fs*0.25}px`,justifyContent:'center',padding:`${fs*0.15}px 0`}},
        s.w.map((w,i)=>React.createElement(WordCard,{key:i,word:w,lang,pinyin:pin,active:ai===i,onClick:()=>{setAi(i===ai?null:i);spk(w.h);},th,fs}))
      ),
      React.createElement('div',{style:{background:`${th.accent}08`,borderRadius:`${fs*0.2}px`,padding:`${fs*0.14}px ${fs*0.2}px`,marginTop:`${fs*0.15}px`}},
        React.createElement('div',{style:{fontSize:`${fs*0.18}px`,color:th.t3,textTransform:'uppercase',letterSpacing:'1.5px',fontWeight:700,marginBottom:'3px'}},"Structure"),
        React.createElement('div',{style:{display:'flex',flexWrap:'wrap',gap:'3px'}},s.w.map((w,i)=>{const role=R[w.r]||R.object;return React.createElement('span',{key:i,style:{fontSize:`${fs*0.22}px`,color:role.c,fontWeight:700,padding:'2px 5px',borderRadius:'3px',background:`${role.c}12`,fontFamily:"'JetBrains Mono',monospace"}},role.s+(i<s.w.length-1?" ‚Üí":""));}))
      )
    ),
    React.createElement('div',{style:{background:th.surface,borderLeft:`3px solid ${th.accent}`,borderRadius:`0 ${fs*0.2}px ${fs*0.2}px 0`,padding:`${fs*0.2}px ${fs*0.28}px`,fontSize:`${fs*0.32}px`,color:th.t2,lineHeight:1.7}},"üí° "+(isP?s.nP:s.n)),
    showC&&s.col&&React.createElement('div',{style:{background:`${th.accent2}08`,border:`1px solid ${th.accent2}15`,borderRadius:`${fs*0.2}px`,padding:`${fs*0.2}px ${fs*0.28}px`,fontSize:`${fs*0.3}px`,lineHeight:1.7}},React.createElement('span',{style:{color:th.accent2,fontWeight:700}},"üó£Ô∏è "),React.createElement('span',{style:{color:th.t1}},isP?(s.colP||s.col):s.col)),
    showS&&s.st&&React.createElement('div',{style:{background:`${th.accent}08`,borderRadius:`${fs*0.2}px`,padding:`${fs*0.2}px ${fs*0.28}px`,fontSize:`${fs*0.3}px`,color:th.t2,lineHeight:1.7,fontStyle:'italic'}},React.createElement('span',{style:{fontStyle:'normal'}},"üìñ "),isP?(s.stP||s.st):s.st),
    ai!==null&&(()=>{const w=s.w[ai],role=R[w.r]||R.object,tone=gt(w.p),tc=TC[tone];return React.createElement('div',{style:{background:th.surface,borderRadius:`${fs*0.4}px`,padding:`${fs*0.35}px`,border:`1px solid ${th.border}`,animation:'fadeIn 0.3s ease'}},React.createElement('div',{style:{display:'flex',gap:'14px',alignItems:'center',flexWrap:'wrap'}},React.createElement('div',{onClick:()=>spk(w.h),style:{width:`${fs*3}px`,height:`${fs*3}px`,background:th.card,border:`3px solid ${tc}50`,borderRadius:`${fs*0.35}px`,display:'flex',alignItems:'center',justifyContent:'center',cursor:'pointer',flexShrink:0}},React.createElement('span',{style:{fontSize:`${fs*1.4}px`,fontFamily:th.font,fontWeight:900,color:th.t1}},w.h)),React.createElement('div',{style:{flex:1,minWidth:'100px'}},React.createElement('div',{style:{fontSize:`${fs*0.4}px`,color:tc,fontWeight:600,fontFamily:"'JetBrains Mono',monospace",marginBottom:'4px'}},w.p),React.createElement('div',{style:{fontSize:`${fs*0.32}px`,color:th.t1,marginBottom:'2px'}},"üá∫üá∏ "+w.e),React.createElement('div',{style:{fontSize:`${fs*0.32}px`,color:th.t1,marginBottom:'6px'}},"üáßüá∑ "+w.pt),React.createElement('span',{style:{padding:'3px 8px',borderRadius:'5px',background:`${role.c}15`,fontSize:`${fs*0.22}px`,color:role.c,fontWeight:700}},role.s))))})()
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRACTICE ‚Äî Mic that actually works over HTTPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function SpeechPractice({s,spk,th,fs}){
  const[status,setStatus]=React.useState('idle');
  const[res,setRes]=React.useState(null);
  const recRef=React.useRef(null);
  const timerRef=React.useRef(null);
  const full=s.w.map(w=>w.h).join("");
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;

  React.useEffect(()=>()=>{
    if(recRef.current){try{recRef.current.abort();}catch(e){}}
    if(timerRef.current)clearTimeout(timerRef.current);
  },[s]);

  const stop=()=>{
    if(timerRef.current)clearTimeout(timerRef.current);
    if(recRef.current){try{recRef.current.stop();}catch(e){}}
    recRef.current=null;
    setStatus('idle');
  };

  const start=async()=>{
    if(status==='listening'){stop();return;}
    if(!SR){setRes({err:"Your browser doesn't support speech recognition. Use Chrome."});return;}

    setRes(null);setStatus('requesting');

    // Explicit mic permission request
    try{
      const stream=await navigator.mediaDevices.getUserMedia({audio:true});
      stream.getTracks().forEach(t=>t.stop());
    }catch(e){
      setStatus('idle');
      setRes({err:"Mic blocked. Tap the lock icon üîí in Chrome's address bar ‚Üí Site Settings ‚Üí Microphone ‚Üí Allow."});
      return;
    }

    const rec=new SR();
    rec.lang='zh-CN';rec.continuous=false;rec.interimResults=false;rec.maxAlternatives=3;
    recRef.current=rec;

    rec.onstart=()=>setStatus('listening');
    rec.onresult=(e)=>{
      if(timerRef.current)clearTimeout(timerRef.current);
      const tx=e.results[0][0].transcript;
      const conf=Math.round(e.results[0][0].confidence*100);
      const clean=tx.replace(/\s|[.,!?„ÄÇÔºåÔºÅÔºü]/g,'');
      const target=full.replace(/\s/g,'');
      setRes({tx,conf,m:clean===target||clean.includes(target)||target.includes(clean)});
      setStatus('idle');recRef.current=null;
    };
    rec.onerror=(e)=>{
      if(timerRef.current)clearTimeout(timerRef.current);
      setStatus('idle');recRef.current=null;
      if(e.error==='no-speech')setRes({err:"No speech heard. Try speaking louder."});
      else if(e.error==='not-allowed')setRes({err:"Mic blocked. Allow in Chrome site settings."});
      else if(e.error==='network')setRes({err:"Network error. Speech recognition needs internet."});
      else setRes({err:"Error: "+e.error});
    };
    rec.onend=()=>{
      if(timerRef.current)clearTimeout(timerRef.current);
      if(status==='listening'&&!res){setRes(r=>r||{err:"Didn't catch that. Try again."});}
      setStatus('idle');recRef.current=null;
    };

    timerRef.current=setTimeout(()=>{if(recRef.current){try{recRef.current.stop();}catch(e){}}},10000);

    try{rec.start();}catch(e){setStatus('idle');setRes({err:"Couldn't start mic. Close other apps using it."});}
  };

  const isActive=status==='listening'||status==='requesting';

  return React.createElement('div',{style:{background:th.surface,borderRadius:`${fs*0.4}px`,padding:`${fs*0.45}px`,border:`1px solid ${th.border}`,textAlign:'center'}},
    React.createElement('div',{style:{fontSize:`${fs*0.9}px`,color:th.t1,fontFamily:th.font,fontWeight:800,letterSpacing:'4px',marginBottom:'4px'}},full),
    React.createElement('div',{style:{fontSize:`${fs*0.34}px`,color:th.t3,fontFamily:"'JetBrains Mono',monospace",marginBottom:`${fs*0.4}px`}},s.w.map(w=>w.p).join(" ")),
    React.createElement('div',{style:{display:'flex',gap:'10px',justifyContent:'center',flexWrap:'wrap'}},
      React.createElement('button',{onClick:()=>spk(full),style:{background:`${th.accent}18`,border:`1px solid ${th.accent}30`,borderRadius:'10px',padding:'10px 20px',color:th.accent,cursor:'pointer',fontSize:`${fs*0.34}px`,fontWeight:600}},"üîä Listen first"),
      React.createElement('button',{onClick:start,style:{background:isActive?'#e06060':th.accent,border:'none',borderRadius:'10px',padding:'10px 20px',color:'#fff',cursor:'pointer',fontSize:`${fs*0.34}px`,fontWeight:700,animation:status==='listening'?'pulse 1.5s infinite':'none',opacity:status==='requesting'?0.6:1}},status==='requesting'?"‚è≥ Getting mic...":status==='listening'?"‚èπÔ∏è Tap to stop":"üé§ Speak")
    ),
    status==='listening'&&React.createElement('div',{style:{marginTop:'10px',color:'#e06060',fontSize:`${fs*0.28}px`,animation:'breathe 1.5s infinite'}},"üî¥ Listening ‚Äî speak the sentence clearly"),
    res&&res.err&&React.createElement('div',{style:{marginTop:'14px',background:'rgba(244,190,80,0.1)',border:'1px solid rgba(244,190,80,0.25)',borderRadius:'12px',padding:'14px',color:'#F4BE50',fontSize:`${fs*0.3}px`,lineHeight:1.6,textAlign:'left'}},"‚ö†Ô∏è "+res.err),
    res&&!res.err&&React.createElement('div',{style:{marginTop:'14px',background:res.m?'rgba(80,212,160,0.1)':'rgba(244,190,80,0.1)',border:`1px solid ${res.m?'rgba(80,212,160,0.25)':'rgba(244,190,80,0.25)'}`,borderRadius:'12px',padding:'14px'}},
      React.createElement('div',{style:{fontSize:'24px',marginBottom:'4px'}},res.m?"‚úÖ":"üîÑ"),
      React.createElement('div',{style:{color:res.m?'#50D4A0':'#F4BE50',fontWeight:700,fontSize:`${fs*0.36}px`}},res.m?"Â§™Ê£í‰∫ÜÔºÅNailed it!":"ÂÜçËØï Try again"),
      React.createElement('div',{style:{color:th.t2,fontSize:`${fs*0.3}px`,marginTop:'6px'}},"Heard: ",React.createElement('span',{style:{color:th.t1,fontFamily:th.font,fontSize:`${fs*0.38}px`}},res.tx)),
      React.createElement('div',{style:{color:th.t3,fontSize:`${fs*0.24}px`,marginTop:'2px'}},res.conf+"% confidence")
    )
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STORIES VIEW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function StoriesView({th,fs,lang}){
  const[dismissed,setDismissed]=React.useState(()=>{try{return JSON.parse(localStorage.getItem('mb_dismissed')||'[]');}catch(e){return[];}});
  const[expanded,setExpanded]=React.useState(null);
  const isP=lang==="portuguese"||lang==="both";
  const visible=STORIES.filter(s=>!dismissed.includes(s.id));
  const cats=[...new Set(visible.map(s=>s.cat))];
  const dismiss=(id)=>{const n=[...dismissed,id];setDismissed(n);try{localStorage.setItem('mb_dismissed',JSON.stringify(n));}catch(e){}setExpanded(null);};
  const resetAll=()=>{setDismissed([]);try{localStorage.removeItem('mb_dismissed');}catch(e){}setExpanded(null);};

  if(visible.length===0)return React.createElement('div',{style:{textAlign:'center',padding:'40px 20px'}},
    React.createElement('div',{style:{fontSize:'40px',marginBottom:'10px'}},"üéâ"),
    React.createElement('div',{style:{fontSize:`${fs*0.4}px`,color:th.t1,fontWeight:700,marginBottom:'8px'}},"All caught up!"),
    React.createElement('div',{style:{fontSize:`${fs*0.3}px`,color:th.t3,marginBottom:'16px'}},"You've read all "+STORIES.length+" stories"),
    React.createElement('button',{onClick:resetAll,style:{background:th.accent,border:'none',borderRadius:'10px',padding:'10px 20px',color:'#fff',cursor:'pointer',fontSize:`${fs*0.3}px`,fontWeight:600}},"‚ôªÔ∏è Bring them back")
  );

  return React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:'8px'}},
    React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
      React.createElement('div',{style:{fontSize:`${fs*0.28}px`,color:th.t3}},visible.length+"/"+STORIES.length+" stories"),
      dismissed.length>0&&React.createElement('button',{onClick:resetAll,style:{background:`${th.accent}15`,border:`1px solid ${th.accent}30`,borderRadius:'8px',padding:'4px 10px',color:th.accent,cursor:'pointer',fontSize:`${fs*0.22}px`}},"‚ôªÔ∏è Reset")
    ),
    cats.map(cat=>React.createElement(React.Fragment,{key:cat},
      React.createElement('div',{style:{fontSize:`${fs*0.2}px`,color:th.t3,textTransform:'uppercase',letterSpacing:'1.5px',fontWeight:700,marginTop:'6px'}},cat),
      visible.filter(s=>s.cat===cat).map(story=>{
        const isOpen=expanded===story.id;
        return React.createElement('div',{key:story.id,style:{background:th.surface,border:`1px solid ${isOpen?th.accent+'40':th.border}`,borderRadius:`${fs*0.3}px`,overflow:'hidden',transition:'all 0.3s'}},
          React.createElement('div',{onClick:()=>setExpanded(isOpen?null:story.id),style:{padding:`${fs*0.3}px`,cursor:'pointer',display:'flex',justifyContent:'space-between',alignItems:'center'}},
            React.createElement('div',{style:{fontSize:`${fs*0.32}px`,color:th.t1,fontWeight:700,lineHeight:1.3,flex:1}},isP?(story.titleP||story.title):story.title),
            React.createElement('span',{style:{color:th.t3,fontSize:'14px',marginLeft:'8px',flexShrink:0}},isOpen?"‚ñ≤":"‚ñº")
          ),
          isOpen&&React.createElement('div',{style:{padding:`0 ${fs*0.3}px ${fs*0.3}px`,animation:'fadeIn 0.2s ease'}},
            React.createElement('div',{style:{fontSize:`${fs*0.29}px`,color:th.t2,lineHeight:1.8,marginBottom:'12px'}},isP?(story.bodyP||story.body):story.body),
            React.createElement('div',{style:{background:`${th.accent}10`,border:`1px solid ${th.accent}20`,borderRadius:'8px',padding:'10px',marginBottom:'12px'}},
              React.createElement('div',{style:{fontSize:`${fs*0.18}px`,color:th.accent,textTransform:'uppercase',letterSpacing:'1px',fontWeight:700,marginBottom:'4px'}},"üîë Key"),
              React.createElement('div',{style:{fontSize:`${fs*0.3}px`,color:th.t1,fontWeight:600}},isP?(story.keyP||story.key):story.key)
            ),
            React.createElement('button',{onClick:()=>dismiss(story.id),style:{width:'100%',background:`${th.accent2}15`,border:`1px solid ${th.accent2}25`,borderRadius:'8px',padding:'8px',color:th.accent2,cursor:'pointer',fontSize:`${fs*0.28}px`,fontWeight:600}},"‚úì Got it ‚Äî dismiss")
          )
        );
      })
    ))
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Settings({thm,setThm,fs,setFs,sc,setSc,ss,setSs,lang,setLang,pin,setPin,rate,setRate,close}){
  const th=THEMES[thm];
  const row=(label,child)=>React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'10px 0',borderBottom:`1px solid ${th.border}`}},React.createElement('span',{style:{fontSize:'14px',color:th.t2}},label),child);
  const tog=(val,set)=>React.createElement('button',{onClick:()=>set(!val),style:{width:'40px',height:'22px',borderRadius:'11px',border:'none',background:val?th.accent:`${th.t3}40`,cursor:'pointer',position:'relative'}},React.createElement('div',{style:{width:'16px',height:'16px',borderRadius:'8px',background:'#fff',position:'absolute',top:'3px',left:val?'21px':'3px',transition:'all 0.2s'}}));
  return React.createElement('div',{onClick:e=>{if(e.target===e.currentTarget)close();},style:{position:'fixed',inset:0,zIndex:100,background:'rgba(0,0,0,0.65)',backdropFilter:'blur(8px)',display:'flex',justifyContent:'center',alignItems:'flex-start',padding:'30px 14px',overflowY:'auto'}},
    React.createElement('div',{style:{background:th.bgSolid,borderRadius:'16px',padding:'20px',maxWidth:'400px',width:'100%',border:`1px solid ${th.border}`,maxHeight:'80vh',overflowY:'auto'}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',marginBottom:'14px'}},React.createElement('h2',{style:{margin:0,color:th.t1,fontSize:'18px'}},"‚öôÔ∏è Settings"),React.createElement('button',{onClick:close,style:{background:'none',border:'none',color:th.t3,fontSize:'18px',cursor:'pointer'}},"‚úï")),
      React.createElement('div',{style:{fontSize:'11px',color:th.t3,textTransform:'uppercase',letterSpacing:'1.5px',fontWeight:700,margin:'8px 0 6px'}},"Theme"),
      React.createElement('div',{style:{display:'flex',flexWrap:'wrap',gap:'6px',marginBottom:'12px'}},Object.entries(THEMES).map(([k,v])=>React.createElement('button',{key:k,onClick:()=>setThm(k),style:{padding:'6px 12px',borderRadius:'8px',border:thm===k?`2px solid ${v.accent}`:`1px solid ${th.border}`,background:thm===k?`${v.accent}20`:'transparent',color:thm===k?v.accent:th.t2,cursor:'pointer',fontSize:'13px',fontWeight:600}},v.emoji+" "+v.name))),
      row("Font "+fs+"px",React.createElement('input',{type:'range',min:22,max:50,value:fs,onChange:e=>setFs(Number(e.target.value)),style:{width:'120px',accentColor:th.accent}})),
      row("Speed "+rate+"x",React.createElement('input',{type:'range',min:0.3,max:1.2,step:0.1,value:rate,onChange:e=>setRate(parseFloat(e.target.value)),style:{width:'120px',accentColor:th.accent}})),
      row("Pinyin",tog(pin,setPin)),row("üó£Ô∏è Street Talk",tog(sc,setSc)),row("üìñ Culture",tog(ss,setSs)),
      React.createElement('div',{style:{fontSize:'11px',color:th.t3,textTransform:'uppercase',letterSpacing:'1.5px',fontWeight:700,margin:'12px 0 6px'}},"Translation"),
      React.createElement('div',{style:{display:'flex',gap:'6px'}},[["english","üá∫üá∏"],["portuguese","üáßüá∑"],["both","Both"]].map(([v,l])=>React.createElement('button',{key:v,onClick:()=>setLang(v),style:{flex:1,padding:'6px',borderRadius:'8px',border:`1px solid ${lang===v?th.accent:th.border}`,background:lang===v?`${th.accent}18`:'transparent',color:lang===v?th.accent:th.t3,cursor:'pointer',fontSize:'13px',fontWeight:600}},l)))
    )
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN APP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function MindBridge(){
  const[cL,setCL]=React.useState(0);const[cS,setCS]=React.useState(0);const[lang,setLang]=React.useState("both");const[pin,setPin]=React.useState(true);const[ai,setAi]=React.useState(null);const[mode,setMode]=React.useState("study");const[stg,setStg]=React.useState(false);const[thm,setThm]=React.useState("cosmic");const[fs,setFs]=React.useState(30);const[rate,setRate]=React.useState(0.8);const[sc,setSc]=React.useState(true);const[ss,setSs]=React.useState(true);
  const lesson=LESSONS[cL],sent=lesson.ss[cS],th=THEMES[thm];
  const totalWords=LESSONS.reduce((a,l)=>a+l.ss.reduce((b,s)=>b+s.w.length,0),0);

  const speak=React.useCallback((text)=>{if(!window.speechSynthesis)return;window.speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(text);u.lang="zh-CN";u.rate=rate;const voices=window.speechSynthesis.getVoices();const v=voices.find(v=>v.lang.startsWith("zh"))||voices[0];if(v)u.voice=v;window.speechSynthesis.speak(u);},[rate]);
  React.useEffect(()=>{if(!window.speechSynthesis)return;window.speechSynthesis.getVoices();window.speechSynthesis.onvoiceschanged=()=>window.speechSynthesis.getVoices();},[]);

  const next=()=>{if(cS<lesson.ss.length-1)setCS(s=>s+1);else if(cL<LESSONS.length-1){setCL(l=>l+1);setCS(0);}setAi(null);};
  const prev=()=>{if(cS>0)setCS(s=>s-1);else if(cL>0){const nl=cL-1;setCL(nl);setCS(LESSONS[nl].ss.length-1);}setAi(null);};

  return React.createElement('div',{style:{minHeight:'100vh',height:'100dvh',display:'flex',flexDirection:'column',background:th.bg,color:th.t1,fontFamily:"'Outfit','Noto Sans SC',sans-serif"}},
    stg&&React.createElement(Settings,{thm,setThm,fs,setFs,sc,setSc,ss,setSs,lang,setLang,pin,setPin,rate,setRate,close:()=>setStg(false)}),
    React.createElement('div',{style:{background:th.header,backdropFilter:'blur(16px)',borderBottom:`1px solid ${th.border}`,padding:'10px 14px',flexShrink:0}},
      React.createElement('div',{style:{maxWidth:'800px',margin:'0 auto',display:'flex',justifyContent:'space-between',alignItems:'center'}},
        React.createElement('h1',{style:{margin:0,fontSize:`${fs*0.48}px`,fontWeight:900,background:`linear-gradient(135deg,${th.accent},${th.accent2})`,WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'}},"ÂêçÊ°•"),
        React.createElement('div',{style:{display:'flex',gap:'3px'}},
          [["study","üìñ"],["practice","üé§"],["stories","üìö"]].map(([m,e])=>React.createElement('button',{key:m,onClick:()=>setMode(m),style:{padding:'5px 8px',borderRadius:'8px',border:'none',background:mode===m?th.accent:`${th.accent}15`,color:mode===m?'#fff':th.t3,fontSize:`${fs*0.22}px`,fontWeight:700,cursor:'pointer'}},e)),
          React.createElement('button',{onClick:()=>setStg(true),style:{padding:'5px 8px',borderRadius:'8px',border:'none',background:`${th.accent}15`,color:th.t3,fontSize:`${fs*0.22}px`,cursor:'pointer'}},"‚öôÔ∏è")
        )
      )
    ),
    React.createElement('div',{style:{flex:1,overflowY:'auto',overflowX:'hidden'}},
      React.createElement('div',{style:{maxWidth:'800px',margin:'0 auto',padding:'12px 12px 20px 12px'}},
        mode==="stories"?React.createElement(StoriesView,{th,fs,lang}):
        React.createElement(React.Fragment,null,
          React.createElement('div',{style:{display:'flex',gap:'5px',marginBottom:'10px',overflowX:'auto',paddingBottom:'2px'}},LESSONS.map((l,i)=>React.createElement('button',{key:l.id,onClick:()=>{setCL(i);setCS(0);setAi(null);},style:{padding:'6px 12px',borderRadius:'8px',border:`1px solid ${i===cL?th.accent:th.border}`,background:i===cL?`${th.accent}18`:'transparent',color:i===cL?th.accent:th.t3,fontSize:`${fs*0.24}px`,fontWeight:600,cursor:'pointer',whiteSpace:'nowrap',flexShrink:0}},l.tz+" "+l.title))),
          React.createElement('div',{style:{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'10px'}},
            React.createElement('span',{style:{fontSize:`${fs*0.24}px`,color:th.t3}},`${cS+1}/${lesson.ss.length} ¬∑ ${totalWords} words`),
            React.createElement('div',{style:{display:'flex',gap:'4px'}},lesson.ss.map((_,i)=>React.createElement('div',{key:i,onClick:()=>{setCS(i);setAi(null);},style:{width:i===cS?'18px':'7px',height:'7px',borderRadius:'4px',background:i===cS?th.accent:i<cS?`${th.accent}50`:th.border,cursor:'pointer',transition:'all 0.3s'}})))
          ),
          mode==="study"?React.createElement(SentenceView,{s:sent,lang,pin,ai,setAi,spk:speak,th,fs,showC:sc,showS:ss}):React.createElement(SpeechPractice,{s:sent,spk:speak,th,fs})
        )
      )
    ),
    mode!=="stories"&&React.createElement('div',{style:{flexShrink:0,background:th.header,backdropFilter:'blur(16px)',borderTop:`1px solid ${th.border}`,padding:'10px 14px',display:'flex',justifyContent:'space-between',gap:'8px'}},
      React.createElement('button',{onClick:prev,style:{padding:`${fs*0.22}px ${fs*0.4}px`,borderRadius:`${fs*0.25}px`,border:`1px solid ${th.border}`,background:'transparent',color:th.t2,fontSize:`${fs*0.32}px`,fontWeight:600,cursor:'pointer'}},"‚Üê Prev"),
      React.createElement('button',{onClick:()=>speak(sent.w.map(w=>w.h).join("")),style:{padding:`${fs*0.22}px ${fs*0.5}px`,borderRadius:`${fs*0.25}px`,border:'none',background:`linear-gradient(135deg,${th.accent},${th.accent2})`,color:'#fff',fontSize:`${fs*0.34}px`,fontWeight:700,cursor:'pointer'}},"üîä"),
      React.createElement('button',{onClick:next,style:{padding:`${fs*0.22}px ${fs*0.4}px`,borderRadius:`${fs*0.25}px`,border:`1px solid ${th.accent}30`,background:`${th.accent}10`,color:th.accent,fontSize:`${fs*0.32}px`,fontWeight:700,cursor:'pointer'}},"Next ‚Üí")
    )
  );
}

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(MindBridge));
</script>
</body>
</html>
